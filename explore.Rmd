---
title: "Explore"
author: "patmau"
date: "11/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r read files}
library(ngram)

#srcDir <- "data/final/en_US"
srcDir <- "data/sample10"
src <- c(blogs = "blogs", news = "news", twitter = "twitter")

lines <- sapply(src, function(s) {
    fileName <- paste("sample10.en_US", s, "txt", sep = ".")
    file <- paste(srcDir, fileName, sep = "/")
    con <- file(file, "r")
    lns <- readLines(con, skipNul = TRUE)
    close(con)
    lns
})

counts <- data.frame(
    sapply(lines, function(lns) {
        size <- object.size(lns) 
        lineCount <- length(lns)
        c(size = size, lineCount = lineCount)
    }) 
)

counts$total <- rowSums(counts)
counts

```

```{r character counts}
charCounts <- sapply(lines, function(lns) {
    sapply(lns, nchar, USE.NAMES = FALSE)
})

wordCounts <- sapply(lines, function(lns) {
    sapply(lns, wordcount, USE.NAMES = FALSE)
})

sapply(charCounts, quantile)
sapply(wordCounts, quantile)
sapply(charCounts, function(c) {mean(c <= 600)})
```

```{r graphs, message = FALSE}
library(dplyr)
library(reshape2)
library(ggplot2)
library(gridExtra)

meltedChar <- melt(charCounts, value.name = "count") %>%
    filter(count <= 600)
ggplot(meltedChar) +
    geom_density(aes(x = count, col = L1))
```

```{r timings, message=FALSE}
library(quanteda)
quanteda_options(threads = 4)

nlines <- c(1000, 2000, 5000, 10000, 20000)

timings <- sapply(nlines, function(n) {
    entries <- lines$news[1:n]
    startTime <- proc.time()
    wc <- wordcount(entries)
    tk <- tokens(entries, remove_punct = TRUE, remove_symbols = TRUE, remove_url = TRUE)
    ngrams <- tokens_ngrams(tk, n = 3)
    endTime <- proc.time() - startTime
    c(wordCount = wc, time = endTime["elapsed"], mem = object.size(ngrams) / 1024^2)
})

timings <- data.frame(wordCount = timings[1, ], time = timings[2, ], mem = timings[3, ])
timings

tplot <- ggplot(timings) +
    geom_point(aes(x = wordCount, y = time)) +
    geom_smooth(aes(x = wordCount, y = time), method = "lm")
mplot <- ggplot(timings) +
    geom_point(aes(x = wordCount, y = mem)) +
    geom_smooth(aes(x = wordCount, y = mem), method = "lm")

grid.arrange(tplot, mplot, ncol = 2)
```
